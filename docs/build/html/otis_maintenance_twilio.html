<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>4. Updating Twilio for new legal issue</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="_static/css/themeoverrides.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=d5fad431"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="5. Twilio token updates" href="otis_maintenance_tokens.html" />
  <link rel="prev" title="3. Create a rest export for the case acceptance" href="otis_maintenance_case_acceptance_view.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">ILAO</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation"
         class="nav-link ">
         Contents:
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation"
         class="nav-link ">
         See also:
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation"
         class="nav-link ">
         Contents:
      </a>
    </div>
  
    <div class="nav-item">
      <a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation"
         class="nav-link ">
         See also:
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation">Contents:</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="design_guide.html" class="reference internal ">Design & Style Guide</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="block_management.html" class="reference internal ">Custom blocks</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="people_management.html" class="reference internal ">User Management</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="legal_information.html" class="reference internal ">Browsing to legal information</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="legal_content_cms.html" class="reference internal ">Legal Content CMS</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="cms_structured_legal_content.html" class="reference internal ">Next generation content/COPE</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="basic_pages_cms.html" class="reference internal ">Basic pages</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="testimonials_cms.html" class="reference internal ">Testimonials Content Type</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="webforms_cms.html" class="reference internal ">Webforms</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="translation_cms.html" class="reference internal ">Translation Management</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="calendar_cms.html" class="reference internal ">Calendar</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="jobs_cms.html" class="reference internal ">Job Listings</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="discussion_groups.html" class="reference internal ">Discussion groups</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="otis_cms.html" class="reference internal ">Get Legal Help</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="site_search.html" class="reference internal ">Site Search</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="site_faqs.html" class="reference internal ">Site FAQs</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="other_cms_features.html" class="reference internal ">Other Website Features</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="taxonomies.html" class="reference internal ">Taxonomies</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="rss_feeds.html" class="reference internal ">RSS Feeds</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="ilao_api.html" class="reference internal ">ILAO’s API</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="next_steps.html" class="reference internal ">Next Steps Flows</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="sms_overview.html" class="reference internal ">SMS Overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="data_analytics.html" class="reference internal ">Data and Analytics</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#welcome-to-illinois-legal-aid-online-product-documentation">See also:</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="creating_docs_in_github.html" class="reference internal ">Creating new docs in Github</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
      <li><a href="otis_cms.html">Get Legal Help</a> &raquo;</li>
    
      <li><a href="otis_sms_intake.html">Online Intake Over SMS</a> &raquo;</li>
    
      <li><a href="otis_maintenance.html">Maintaining and expanding OTIS SMS</a> &raquo;</li>
    
    <li><span class="section-number">4. </span>Updating Twilio for new legal issue</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="otis_maintenance_case_acceptance_view.html"
       title="previous chapter">← <span class="section-number">3. </span>Create a rest export for the case acceptance</a>
  </li>
  <li class="next">
    <a href="otis_maintenance_tokens.html"
       title="next chapter"><span class="section-number">5. </span>Twilio token updates →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="updating-twilio-for-new-legal-issue">
<h1><span class="section-number">4. </span>Updating Twilio for new legal issue<a class="headerlink" href="#updating-twilio-for-new-legal-issue" title="Link to this heading"></a></h1>
<section id="step-1-update-functions">
<h2><span class="section-number">4.1. </span>Step 1: Update functions<a class="headerlink" href="#step-1-update-functions" title="Link to this heading"></a></h2>
<section id="update-the-get-process-function">
<h3><span class="section-number">4.1.1. </span>Update the “get process” function<a class="headerlink" href="#update-the-get-process-function" title="Link to this heading"></a></h3>
<p>Open the get-process-list function in the guided-nav function under Functions-&gt;Services in Twilio.  There is a case function that contains each of the legal issues supported by the application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For best results, copy the code to a text editor first in case you need to undo your changes.</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="o">:</span><span class="w"> </span><span class="c1">//unemployment</span>
<span class="nx">processid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;9fa873d0-55b8-11eb-939c-0e8d40a13cd5&quot;</span><span class="p">;</span>
<span class="nx">lsc_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;76 Unemployment Compensation&quot;</span><span class="p">;</span>
<span class="nx">search_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;afa23f49-7a9d-4caf-b9ac-63da005dc20a&quot;</span><span class="p">;</span>
<span class="nx">content_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://www.illinoislegalaid.org/legal-information/unemployment-benefits&quot;</span><span class="p">;</span>
<span class="nx">rest_export</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://www.illinoislegalaid.org/rest/unemployment-cases&quot;</span><span class="p">;</span>
<span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>For each legal issue there is:</p>
<ul class="simple">
<li><p>A case with a number. This matches the number from the SMS widget that asks the user to select their problem. Adding a new one should be added after the last one with the next sequential number.</p></li>
<li><p>processid: this is the unique process id from Legal Server;</p></li>
<li><p>lsc_code: this should be the string that matches Legal Server’s incoming values for Legal Problem Code list;</p></li>
<li><p>search_term: this is the id for the legal issue taxonomy term. You can find this by going to <a class="reference external" href="https://www.illinoislegalaid.org/jsonapi/taxonomy_term/legal_issues?filter[foo][condition][operator]==&amp;filter[foo][condition][path]=drupal_internal__tid&amp;filter[foo][condition][value]=514486">https://www.illinoislegalaid.org/jsonapi/taxonomy_term/legal_issues?filter[foo][condition][operator]==&amp;filter[foo][condition][path]=drupal_internal__tid&amp;filter[foo][condition][value]=514486</a> (replace the id at the end for the actual term id; then grab the id.;</p></li>
<li><p>content_url: this should be a landing page for sending a user when they exit the system for a legal topic;</p></li>
<li><p>rest_export: this is the url for the rest export of the related case acceptance view for the legal issue;</p></li>
<li><p>break: be sure to end the legal issue with “break;”</p></li>
</ul>
<p>To add a new issue:
* Add a new case statement with the new information
* Save and deploy the updated function
* Test that the process id is returned. In a browser, open <a class="reference external" href="https://guided-nav-1608.twil.io/get-process-list?issue=">https://guided-nav-1608.twil.io/get-process-list?issue=</a> and append the new number (1,2,3 etc). It should return json like the following:</p>
<blockquote>
<div><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;processid&quot;</span><span class="p">:</span><span class="s2">&quot;9fa873d0-55b8-11eb-939c-0e8d40a13cd5&quot;</span><span class="p">,</span>
<span class="nt">&quot;lsc_code&quot;</span><span class="p">:</span><span class="s2">&quot;76 Unemployment Compensation&quot;</span><span class="p">,</span>
<span class="nt">&quot;search_term&quot;</span><span class="p">:</span><span class="s2">&quot;afa23f49-7a9d-4caf-b9ac-63da005dc20a&quot;</span><span class="p">,</span>
<span class="nt">&quot;content_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://www.illinoislegalaid.org/legal-information/unemployment-benefits&quot;</span><span class="p">,</span>
<span class="nt">&quot;rest_export&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.illinoislegalaid.org/rest/unemployment-cases&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you get anything other than JSON, you have an error. If you can not find it quickly, undo your changes and ask Gwen for help.</p>
</div>
</section>
<section id="update-the-validate-process-function">
<h3><span class="section-number">4.1.2. </span>Update the “”validate process” function<a class="headerlink" href="#update-the-validate-process-function" title="Link to this heading"></a></h3>
<p>In the validate-legal-issue-gn function, there is an array of numbers that are valid input for the list of legal issues. This needs to be updated to include the newly added number from the case statement.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">valid_numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p>There is also a series of if statments that can be used for some natural language processing. You can add new variations by copying and pasting the code below and replacing the ‘tanf’ with whatever string you want to match against and updating the response = to the number that corresponds to the legal issue in the list.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">legal_issue</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;tanf&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All text to search for in the .includes function should be lower-case.</p>
</div>
</section>
</section>
<section id="step-2-update-the-studio-flow">
<h2><span class="section-number">4.2. </span>Step 2: Update the Studio Flow<a class="headerlink" href="#step-2-update-the-studio-flow" title="Link to this heading"></a></h2>
<ul>
<li><p>In the OTIS flow:</p>
<blockquote>
<div><ul class="simple">
<li><p>Step 1: Add a number and label for the legal issue. This should match the number added in step 1. Eviction should be moved down a number as needed.</p></li>
</ul>
<img alt="_images/twilio-legal-issue-start.png" src="_images/twilio-legal-issue-start.png" />
<ul class="simple">
<li><p>Step 2: Update the legal-issue-split widget to:</p>
<ul>
<li><p>add the number to the post-triage-start route; this will include it in Guided Navigation</p></li>
<li><p>if you moved eviction from 4 to another number, update the exit-to-eviction message.</p></li>
</ul>
</li>
</ul>
<img alt="_images/twilio-split-legal-issue.png" src="_images/twilio-split-legal-issue.png" />
</div></blockquote>
</li>
</ul>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="otis_maintenance_case_acceptance_view.html"
       title="previous chapter">← <span class="section-number">3. </span>Create a rest export for the case acceptance</a>
  </li>
  <li class="next">
    <a href="otis_maintenance_tokens.html"
       title="next chapter"><span class="section-number">5. </span>Twilio token updates →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2023, Illinois Legal Aid Online.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>