
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4. Updating Twilio for new legal issue &#8212; ILAO Sprint 124 documentation</title>
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="../html/_static/css/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="../build/html/_static/css/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/theme_overrides.css" type="text/css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Twilio token updates" href="otis_maintenance_tokens.html" />
    <link rel="prev" title="3. Create a rest export for the case acceptance" href="otis_maintenance_case_acceptance_view.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="otis_maintenance_tokens.html" title="5. Twilio token updates"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="otis_maintenance_case_acceptance_view.html" title="3. Create a rest export for the case acceptance"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ILAO Sprint 124 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="otis_cms.html" >Get Legal Help</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="otis_sms_intake.html" >Online Intake Over SMS</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="otis_maintenance.html" accesskey="U">Maintaining and expanding OTIS SMS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4. </span>Updating Twilio for new legal issue</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="updating-twilio-for-new-legal-issue">
<h1><span class="section-number">4. </span>Updating Twilio for new legal issue<a class="headerlink" href="#updating-twilio-for-new-legal-issue" title="Permalink to this headline">¶</a></h1>
<div class="section" id="step-1-update-functions">
<h2><span class="section-number">4.1. </span>Step 1: Update functions<a class="headerlink" href="#step-1-update-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="update-the-get-process-function">
<h3><span class="section-number">4.1.1. </span>Update the “get process” function<a class="headerlink" href="#update-the-get-process-function" title="Permalink to this headline">¶</a></h3>
<p>Open the get-process-list function in the guided-nav function under Functions-&gt;Services in Twilio.  There is a case function that contains each of the legal issues supported by the application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For best results, copy the code to a text editor first in case you need to undo your changes.</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">&quot;1&quot;</span><span class="o">:</span> <span class="c1">//unemployment</span>
<span class="nx">processid</span> <span class="o">=</span> <span class="s2">&quot;9fa873d0-55b8-11eb-939c-0e8d40a13cd5&quot;</span><span class="p">;</span>
<span class="nx">lsc_code</span> <span class="o">=</span> <span class="s2">&quot;76 Unemployment Compensation&quot;</span><span class="p">;</span>
<span class="nx">search_term</span> <span class="o">=</span> <span class="s2">&quot;afa23f49-7a9d-4caf-b9ac-63da005dc20a&quot;</span><span class="p">;</span>
<span class="nx">content_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.illinoislegalaid.org/legal-information/unemployment-benefits&quot;</span><span class="p">;</span>
<span class="nx">rest_export</span> <span class="o">=</span> <span class="s2">&quot;https://www.illinoislegalaid.org/rest/unemployment-cases&quot;</span><span class="p">;</span>
<span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>For each legal issue there is:</p>
<ul class="simple">
<li><p>A case with a number. This matches the number from the SMS widget that asks the user to select their problem. Adding a new one should be added after the last one with the next sequential number.</p></li>
<li><p>processid: this is the unique process id from Legal Server;</p></li>
<li><p>lsc_code: this should be the string that matches Legal Server’s incoming values for Legal Problem Code list;</p></li>
<li><p>search_term: this is the id for the legal issue taxonomy term. You can find this by going to <a class="reference external" href="https://www.illinoislegalaid.org/jsonapi/taxonomy_term/legal_issues?filter[foo][condition][operator]==&amp;filter[foo][condition][path]=drupal_internal__tid&amp;filter[foo][condition][value]=514486">https://www.illinoislegalaid.org/jsonapi/taxonomy_term/legal_issues?filter[foo][condition][operator]==&amp;filter[foo][condition][path]=drupal_internal__tid&amp;filter[foo][condition][value]=514486</a> (replace the id at the end for the actual term id; then grab the id.;</p></li>
<li><p>content_url: this should be a landing page for sending a user when they exit the system for a legal topic;</p></li>
<li><p>rest_export: this is the url for the rest export of the related case acceptance view for the legal issue;</p></li>
<li><p>break: be sure to end the legal issue with “break;”</p></li>
</ul>
<p>To add a new issue:
* Add a new case statement with the new information
* Save and deploy the updated function
* Test that the process id is returned. In a browser, open <a class="reference external" href="https://guided-nav-1608.twil.io/get-process-list?issue=">https://guided-nav-1608.twil.io/get-process-list?issue=</a> and append the new number (1,2,3 etc). It should return json like the following:</p>
<blockquote>
<div><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;processid&quot;</span><span class="p">:</span><span class="s2">&quot;9fa873d0-55b8-11eb-939c-0e8d40a13cd5&quot;</span><span class="p">,</span>
<span class="nt">&quot;lsc_code&quot;</span><span class="p">:</span><span class="s2">&quot;76 Unemployment Compensation&quot;</span><span class="p">,</span>
<span class="nt">&quot;search_term&quot;</span><span class="p">:</span><span class="s2">&quot;afa23f49-7a9d-4caf-b9ac-63da005dc20a&quot;</span><span class="p">,</span>
<span class="nt">&quot;content_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.illinoislegalaid.org/legal-information/unemployment-benefits&quot;</span><span class="p">,</span>
<span class="nt">&quot;rest_export&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.illinoislegalaid.org/rest/unemployment-cases&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you get anything other than JSON, you have an error. If you can not find it quickly, undo your changes and ask Gwen for help.</p>
</div>
</div>
<div class="section" id="update-the-validate-process-function">
<h3><span class="section-number">4.1.2. </span>Update the “”validate process” function<a class="headerlink" href="#update-the-validate-process-function" title="Permalink to this headline">¶</a></h3>
<p>In the validate-legal-issue-gn function, there is an array of numbers that are valid input for the list of legal issues. This needs to be updated to include the newly added number from the case statement.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">valid_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p>There is also a series of if statments that can be used for some natural language processing. You can add new variations by copying and pasting the code below and replacing the ‘tanf’ with whatever string you want to match against and updating the response = to the number that corresponds to the legal issue in the list.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span> <span class="k">if</span> <span class="p">(</span><span class="nx">legal_issue</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;tanf&#39;</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">response</span> <span class="o">=</span> <span class="mf">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All text to search for in the .includes function should be lower-case.</p>
</div>
</div>
</div>
<div class="section" id="step-2-update-the-studio-flow">
<h2><span class="section-number">4.2. </span>Step 2: Update the Studio Flow<a class="headerlink" href="#step-2-update-the-studio-flow" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>In the OTIS flow:</p>
<blockquote>
<div><ul class="simple">
<li><p>Step 1: Add a number and label for the legal issue. This should match the number added in step 1. Eviction should be moved down a number as needed.</p></li>
</ul>
<img alt="_images/twilio-legal-issue-start.png" src="_images/twilio-legal-issue-start.png" />
<ul class="simple">
<li><p>Step 2: Update the legal-issue-split widget to:</p>
<ul>
<li><p>add the number to the post-triage-start route; this will include it in Guided Navigation</p></li>
<li><p>if you moved eviction from 4 to another number, update the exit-to-eviction message.</p></li>
</ul>
</li>
</ul>
<img alt="_images/twilio-split-legal-issue.png" src="_images/twilio-split-legal-issue.png" />
</div></blockquote>
</li>
</ul>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Updating Twilio for new legal issue</a><ul>
<li><a class="reference internal" href="#step-1-update-functions">4.1. Step 1: Update functions</a><ul>
<li><a class="reference internal" href="#update-the-get-process-function">4.1.1. Update the “get process” function</a></li>
<li><a class="reference internal" href="#update-the-validate-process-function">4.1.2. Update the “”validate process” function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-update-the-studio-flow">4.2. Step 2: Update the Studio Flow</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="otis_maintenance_case_acceptance_view.html"
                        title="previous chapter"><span class="section-number">3. </span>Create a rest export for the case acceptance</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="otis_maintenance_tokens.html"
                        title="next chapter"><span class="section-number">5. </span>Twilio token updates</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/otis_maintenance_twilio.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="otis_maintenance_tokens.html" title="5. Twilio token updates"
             >next</a> |</li>
        <li class="right" >
          <a href="otis_maintenance_case_acceptance_view.html" title="3. Create a rest export for the case acceptance"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ILAO Sprint 124 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="otis_cms.html" >Get Legal Help</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="otis_sms_intake.html" >Online Intake Over SMS</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="otis_maintenance.html" >Maintaining and expanding OTIS SMS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4. </span>Updating Twilio for new legal issue</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Gwen Daniels.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.1.
    </div>
  </body>
</html>